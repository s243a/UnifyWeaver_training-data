{"pair_id": "ps-dotnet-001_p0", "cluster_id": "ps-dotnet-001", "question": "How do I use inline C# with the PowerShell target?", "question_type": "medium", "answer": "To embed C# code directly in your PowerShell output, leverage the `dotnet_source` plugin. Here's how:\n\n```prolog\n:- use_module(library(dotnet_source)).\n\nCSharpCode = '\nusing System;\nnamespace UnifyWeaver.Generated.StringReverser {\n    public class StringReverserHandler {\n        public string ProcessStringReverser(string input) {\n            char[] chars = input.ToCharArray();\n            Array.Reverse(chars);\n            return new string(chars);\n        }\n    }\n}\n',\n\nConfig = [csharp_inline(CSharpCode)],\ndotnet_source:compile_source(string_reverser/2, Config, [], PowerShellCode).\n```\n\n**What gets generated:**\n```powershell\nbegin {\n    Add-Type -TypeDefinition $csharpCode\n    $handler = New-Object UnifyWeaver.Generated.StringReverser.StringReverserHandler\n}\nprocess {\n    $handler.ProcessStringReverser($InputData)\n}\n```\n\nThe PowerShell target automatically wraps your C# in `Add-Type` and instantiates the necessary objects. For comprehensive examples, check education/book-12-powershell-target/04_dotnet_integration.md.", "answer_variant": "default", "answer_source": "book-12-powershell-target/04_dotnet_integration.md", "topics": [], "original_answer": "Use the `dotnet_source` plugin to embed C# code:\n\n```prolog\n:- use_module(library(dotnet_source)).\n\nCSharpCode = '\nusing System;\nnamespace UnifyWeaver.Generated.StringReverser {\n    public class StringReverserHandler {\n        public string ProcessStringReverser(string input) {\n            char[] chars = input.ToCharArray();\n            Array.Reverse(chars);\n            return new string(chars);\n        }\n    }\n}\n',\n\nConfig = [csharp_inline(CSharpCode)],\ndotnet_source:compile_source(string_reverser/2, Config, [], PowerShellCode).\n```\n\n**Generated PowerShell:**\n```powershell\nbegin {\n    Add-Type -TypeDefinition $csharpCode\n    $handler = New-Object UnifyWeaver.Generated.StringReverser.StringReverserHandler\n}\nprocess {\n    $handler.ProcessStringReverser($InputData)\n}\n```", "answer_tailored": true}
{"pair_id": "ps-dotnet-001_p0", "cluster_id": "ps-dotnet-001", "question": "How does DLL caching work for 138x speedup?", "question_type": "medium", "answer": "The DLL caching mechanism achieves 138x speedup by avoiding redundant C# compilation:\n\n**Enable caching:**\n```prolog\nConfig = [csharp_inline(CSharpCode), pre_compile(true)],\ndotnet_source:compile_source(my_pred/2, Config, [], Code).\n```\n\n**Cache flow:**\n1. Generate SHA256 hash of C# source code\n2. Check if `$env:TEMP/unifyweaver_dotnet_cache/{hash}.dll` exists\n3. **Cache hit:** Load pre-compiled DLL directly (~2.8ms)\n4. **Cache miss:** Compile C# code, save DLL to cache, then load (~386ms)\n\n**Generated PowerShell:**\n```powershell\n$codeHash = Get-StringHash $csharpCode\n$cachedDll = \"$env:TEMP/unifyweaver_dotnet_cache/$codeHash.dll\"\n\nif (Test-Path $cachedDll) {\n    Add-Type -Path $cachedDll  # Cached - fast path\n} else {\n    # Compile and store for future use...\n}\n```\n\n**Performance:** Initial compilation takes ~386ms, but all subsequent executions with identical C# code complete in ~2.8ms (138x faster). See education/book-12-powershell-target/04_dotnet_integration.md for implementation details.", "answer_variant": "default", "answer_source": "book-12-powershell-target/04_dotnet_integration.md", "topics": [], "original_answer": "Enable caching with `pre_compile(true)`:\n\n```prolog\nConfig = [csharp_inline(CSharpCode), pre_compile(true)],\ndotnet_source:compile_source(my_pred/2, Config, [], Code).\n```\n\n**How it works:**\n1. Hash the C# source (SHA256)\n2. Check cache: `$env:TEMP/unifyweaver_dotnet_cache/{hash}.dll`\n3. Cache hit: Load existing DLL (~2.8ms)\n4. Cache miss: Compile, save to cache, load (~386ms)\n\n**Generated:**\n```powershell\n$codeHash = Get-StringHash $csharpCode\n$cachedDll = \"$env:TEMP/unifyweaver_dotnet_cache/$codeHash.dll\"\n\nif (Test-Path $cachedDll) {\n    Add-Type -Path $cachedDll  # Fast!\n} else {\n    # Compile and cache...\n}\n```\n\n**Result:** First run ~386ms, subsequent runs ~2.8ms.", "answer_tailored": true}
{"pair_id": "ps-dotnet-002_p0", "cluster_id": "ps-dotnet-002", "question": "How do I use NuGet packages in PowerShell target?", "question_type": "medium", "answer": "To use NuGet packages in PowerShell target, specify them in the `references` configuration with `compile_mode(external)`:\n\n```prolog\nConfig = [\n    csharp_inline(CSharpCode),\n    compile_mode(external),\n    references(['LiteDB', 'System.Text.Json'])\n],\ndotnet_source:compile_source(db_query/3, Config, [], Code).\n```\n\n**Build workflow:**\n1. Generates temporary .NET project\n2. Creates `.csproj` file with PackageReferences for your packages\n3. Executes `dotnet restore` to fetch NuGet packages\n4. Compiles with `dotnet build`\n5. Loads the resulting DLL\n6. Instantiates classes and invokes methods\n\n**Sample .csproj generated:**\n```xml\n<Project Sdk=\"Microsoft.NET.Sdk\">\n  <PropertyGroup><TargetFramework>net8.0</TargetFramework></PropertyGroup>\n  <ItemGroup>\n    <PackageReference Include=\"LiteDB\" Version=\"5.0.0\" />\n  </ItemGroup>\n</Project>\n```\n\nNote: .NET SDK must be installed on the system.", "answer_variant": "default", "answer_source": "book-12-powershell-target/04_dotnet_integration.md", "topics": [], "original_answer": "Use `compile_mode(external)` with `references`:\n\n```prolog\nConfig = [\n    csharp_inline(CSharpCode),\n    compile_mode(external),\n    references(['LiteDB', 'System.Text.Json'])\n],\ndotnet_source:compile_source(db_query/3, Config, [], Code).\n```\n\n**Generated process:**\n1. Creates temporary .NET project\n2. Writes `.csproj` with PackageReferences\n3. Runs `dotnet restore` and `dotnet build`\n4. Loads compiled DLL\n5. Creates instance and calls methods\n\n**Example .csproj:**\n```xml\n<Project Sdk=\"Microsoft.NET.Sdk\">\n  <PropertyGroup><TargetFramework>net8.0</TargetFramework></PropertyGroup>\n  <ItemGroup>\n    <PackageReference Include=\"LiteDB\" Version=\"5.0.0\" />\n  </ItemGroup>\n</Project>\n```\n\nRequires .NET SDK installed.", "answer_tailored": true}
