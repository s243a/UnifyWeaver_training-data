{"cluster_id": "semantic-density-001", "question": "What is flux-softmax density scoring?", "answer": "Density scoring boosts results in semantically dense regions (consensus signal):\n\n**Problem:** Naive max/sum ranks isolated high-scoring results above clustered consensus.\n\n**Flux-softmax formula:**\n```\nP(i) = exp(sᵢ/τ) * (1 + w * dᵢ) / Z\n```\n- τ = temperature (sharpness)\n- w = density weight (0 = ignore, 1 = strong)\n- dᵢ = normalized density score\n\n```python\ndef flux_softmax(scores, densities, density_weight=0.3, temperature=1.0):\n    scaled = scores / temperature - scores.max()\n    flux_factor = 1.0 + density_weight * densities\n    exp_scores = np.exp(scaled) * flux_factor\n    return exp_scores / exp_scores.sum()\n```\n\n**Two-stage pipeline:**\n1. Cluster by similarity (greedy or HDBSCAN)\n2. Compute KDE density **within** each cluster\n3. Apply flux-softmax\n\nDense clusters = consensus = higher probability.", "source_file": "book-13-semantic-search/07_density_scoring.md", "prerequisites": ["semantic-dist-001"]}
{"cluster_id": "semantic-density-001", "question": "How do I configure density scoring in Prolog?", "answer": "Configure via service definition:\n\n```prolog\nservice(semantic_search_node, [\n    transport(http('/kg', [port(8080)])),\n    federation([\n        aggregation(density_flux, [\n            density_weight(0.3),\n            clustering_enabled(true),\n            similarity_threshold(0.7),\n            min_cluster_size(2)\n        ]),\n        federation_k(5)\n    ])\n], [receive(Query), handle_federated_query(Query, Response), respond(Response)]).\n```\n\n**Validation predicates:**\n```prolog\nis_valid_density_option(bandwidth(auto)).\nis_valid_density_option(bandwidth(silverman)).\nis_valid_density_option(bandwidth(B)) :- number(B), B > 0.\nis_valid_density_option(density_weight(W)) :- number(W), W >= 0, W =< 1.\n```\n\n**Tuning:**\n- High precision (legal, medical): `similarity_threshold(0.8+)`\n- Exploratory: `similarity_threshold(0.5-0.6)`\n- Consensus-heavy: `density_weight(0.5+)`", "source_file": "book-13-semantic-search/07_density_scoring.md", "prerequisites": ["semantic-density-001"]}
