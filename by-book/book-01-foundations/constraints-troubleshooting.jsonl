{"cluster_id": "constraint-usage", "seed_level": 2, "source_files": ["src/unifyweaver/core/constraint_analyzer.pl", "docs/CONSTRAINT_SYSTEM.md"], "topics": ["constraints", "unique", "ordered", "deduplication", "optimization"], "questions": ["What are constraints in UnifyWeaver and how do I use them?", "What does unique(true) mean in UnifyWeaver?", "How do constraints affect generated code?", "What deduplication strategies does UnifyWeaver support?"], "answer": {"text": "## Constraints in UnifyWeaver\n\nConstraints tell the compiler about properties of your predicates, enabling optimizations.\n\n### Available Constraints\n\n| Constraint | Meaning | Default |\n|------------|---------|--------|\n| `unique(true)` | Predicate never returns duplicates | true |\n| `unique(false)` | May return duplicates | false |\n| `unordered(true)` | Order doesn't matter | true |\n| `unordered(false)` | Order must be preserved | false |\n\n### Declaring Constraints\n\n```prolog\n% Pragma-style (recommended)\n:- constraint(grandparent/2, [unique(true), unordered(true)]).\n\n% Or programmatically\n?- declare_constraint(my_pred/2, [unique(false)]).\n```\n\n### How Constraints Affect Code Generation\n\n**With `unique(true), unordered(true)` (default):**\n```bash\n# Uses sort -u for deduplication\nresults | sort -u\n```\n\n**With `unique(true), unordered(false)`:**\n```bash\n# Uses hash table to preserve order\ndeclare -A seen\nwhile read line; do\n    [[ -z \"${seen[$line]}\" ]] && { seen[$line]=1; echo \"$line\"; }\ndone\n```\n\n**With `unique(false)`:**\n```bash\n# No deduplication - raw output\nresults\n```\n\n### When to Override Defaults\n\n```prolog\n% Temporal data - order matters!\n:- constraint(event_log/2, [unordered(false)]).\n\n% May have duplicates (counting queries)\n:- constraint(word_count/2, [unique(false)]).\n\n% Set-like operations (default is fine)\n:- constraint(ancestors/2, [unique(true), unordered(true)]).\n```\n\n### Checking Active Constraints\n\n```prolog\n?- get_constraints(my_pred/2, C).\nC = [unique(true), unordered(true)].\n```", "anchor_question_hash": "d2f4a8c6e1b39750"}}
{"cluster_id": "troubleshooting-compilation", "seed_level": 3, "source_files": ["src/unifyweaver/core/firewall.pl", "src/unifyweaver/core/compiler_driver.pl"], "topics": ["troubleshooting", "errors", "debugging", "firewall", "compilation-errors"], "questions": ["How do I debug compilation errors in UnifyWeaver?", "What does 'procedure not found' mean during compilation?", "What is the firewall and how does it affect compilation?", "My generated Bash code gives wrong results - how do I debug?"], "answer": {"text": "## Troubleshooting UnifyWeaver Compilation\n\n### Error: \"procedure not found\"\n\n**Cause:** The predicate isn't loaded or has wrong arity.\n\n```prolog\n?- compile(my_pred/2, [target(bash)], S).\nERROR: Unknown procedure: my_pred/2\n```\n\n**Fix:**\n```prolog\n% Check what's loaded\n?- listing(my_pred).\n\n% Load your file\n?- ['my_predicates.pl'].\n\n% Or assert directly\n?- assertz(my_pred(a, b)).\n```\n\n### Info: \"No firewall rules defined\"\n\n```\nINFO: No firewall rules defined. Using implicit allow.\n```\n\n**Meaning:** The firewall security system isn't configured. This is OK for development.\n\n**To configure:**\n```prolog\n?- use_module(unifyweaver(core/firewall)).\n?- set_firewall_policy([allow(bash), deny(shell_exec)]).\n```\n\n### Wrong Results in Generated Bash\n\n**Step 1: Test Prolog logic first**\n```prolog\n?- my_pred(X, Y).\n% Verify results are correct in Prolog\n```\n\n**Step 2: Check generated code structure**\n```bash\ncat output/my_pred.sh\n# Look for:\n# - Correct key format (arg1:arg2)\n# - Proper array initialization\n# - Visited tracking for recursion\n```\n\n**Step 3: Debug with traces**\n```bash\nsource my_pred.sh\nset -x  # Enable bash tracing\nmy_pred_stream\nset +x\n```\n\n### Common Issues\n\n| Symptom | Cause | Fix |\n|---------|-------|-----|\n| Empty output | Facts not loaded | Check `listing(pred)` |\n| Infinite loop | No cycle detection | Add `unique(true)` constraint |\n| Duplicates | Wrong dedup strategy | Check constraints |\n| Key not found | Wrong arity | Verify `pred/N` matches facts |\n\n### Debugging Recursive Predicates\n\n```prolog\n% Enable compiler tracing\n?- set_prolog_flag(verbose, normal).\n\n% Compile with debug info\n?- compile(reaches/2, [target(bash), debug(true)], S).\n\n% Check classification\n=== Analyzing reaches/2 ===\nClassification: transitive_closure(edge)\n```\n\nIf classification is wrong, simplify your rules to match known patterns.", "anchor_question_hash": "b5e7c3a9f2d18046"}}
