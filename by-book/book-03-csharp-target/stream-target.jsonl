{"cluster_id": "csharp-stream-target", "seed_level": 1, "source_files": ["education/book-03-csharp-target/02_csharp_stream_target.md"], "topics": ["stream-target", "linq", "csharp", "facts"], "questions": ["What is the C# Stream Target?", "How are Prolog facts translated to C#?", "What LINQ operations are generated?", "How do I compile facts to C# arrays?"], "answer": {"text": "## C# Stream Target\n\nThe Stream Target compiles Prolog to LINQ pipelines:\n\n- **Facts** → C# arrays\n- **Rules** → LINQ Select/Where\n- **Multiple clauses** → Union\n- **Deduplication** → Distinct()\n\n### Example: Facts to Arrays\n\n**Prolog:**\n```prolog\nparent(alice, bob).\nparent(bob, charlie).\n```\n\n**Generated C#:**\n```csharp\npublic static class Parent\n{\n    static readonly (string, string)[] Facts = {\n        (\"alice\", \"bob\"),\n        (\"bob\", \"charlie\")\n    };\n\n    public static IEnumerable<(string, string)> Stream()\n        => Facts.AsEnumerable();\n}\n```\n\n### Compile Command\n\n```prolog\n?- compile_predicate_to_csharp(parent/2, [], Code),\n   open('Parent.cs', write, S),\n   write(S, Code),\n   close(S).\n```\n\n### Type Inference\n\n| Prolog | C# Type |\n|--------|--------|\n| `42` | `int` |\n| `3.14` | `double` |\n| `atom` | `string` |\n| `(a, b)` | `(string, string)` |", "anchor_question_hash": "03c1d2e3f4050001"}}
{"cluster_id": "csharp-stream-rules", "seed_level": 2, "source_files": ["education/book-03-csharp-target/02_csharp_stream_target.md"], "topics": ["rules", "linq", "where", "join"], "questions": ["How are Prolog rules translated to LINQ?", "How does the Join operation work in C#?", "How are multiple clauses combined?", "What is the Union pattern for clauses?"], "answer": {"text": "## Rules to LINQ Translation\n\n### Simple Rule with Conditions\n\n**Prolog:**\n```prolog\nadult(Person) :-\n    age(Person, Age),\n    Age >= 18.\n```\n\n**Generated C#:**\n```csharp\npublic static IEnumerable<string> Stream()\n{\n    return AgeFacts\n        .Where(t => t.Item2 >= 18)  // Age >= 18\n        .Select(t => t.Item1);       // Return Person\n}\n```\n\n### Join Pattern (Grandparent)\n\n**Prolog:**\n```prolog\ngrandparent(GP, GC) :- parent(GP, P), parent(P, GC).\n```\n\n**Generated C#:**\n```csharp\nreturn ParentFacts\n    .Join(\n        ParentFacts,\n        outer => outer.Item2,  // P (child)\n        inner => inner.Item1,  // P (parent)\n        (outer, inner) => (outer.Item1, inner.Item2)  // (GP, GC)\n    );\n```\n\n### Multiple Clauses → Union\n\n**Prolog:**\n```prolog\nsibling(alice, bob).  % Fact\nsibling(X, Y) :- parent(P, X), parent(P, Y), X \\= Y.  % Rule\n```\n\n**Generated:**\n```csharp\nvar clause1 = new[] { (\"alice\", \"bob\") };\nvar clause2 = /* computed siblings */;\nreturn clause1.Union(clause2);  // Combines both\n```", "anchor_question_hash": "03c2d3e4f5060002"}}
{"cluster_id": "stream-target-limitations", "seed_level": 2, "source_files": ["education/book-03-csharp-target/02_csharp_stream_target.md"], "topics": ["limitations", "recursion", "stream-target"], "questions": ["What are the limitations of the Stream Target?", "Why doesn't Stream Target support recursion?", "What built-ins are supported in Stream Target?", "When should I use Query Runtime instead?"], "answer": {"text": "## Stream Target Limitations\n\n### 1. No Recursion\n\n**Does NOT work:**\n```prolog\nancestor(X, Y) :- parent(X, Y).\nancestor(X, Z) :- parent(X, Y), ancestor(Y, Z).  % Recursive!\n```\n\n**Workaround:** Use C# Query Runtime (Chapter 3)\n\n### 2. No Repeated Head Variables\n\n**Does NOT work:**\n```prolog\nduplicate(X, X) :- number(X).  % X appears twice\n```\n\n**Workaround:** Add explicit equality in body\n\n### 3. Limited Built-ins\n\n**Supported:** `=`, `\\=`, `<`, `>`, `=<`, `>=`, `is`\n\n**Not supported:** `findall`, `bagof`, `setof`, complex arithmetic\n\n### When to Use Query Runtime\n\n- Recursive predicates (ancestor, transitive closure)\n- Complex query optimization needed\n- Semi-naive evaluation required\n- Mutual recursion (is_even/is_odd)\n\n### Decision\n\n```\nIs predicate recursive?\n├─ NO  → Stream Target (simple, fast)\n└─ YES → Query Runtime (handles recursion)\n```", "anchor_question_hash": "03c3d4e5f6070003"}}
