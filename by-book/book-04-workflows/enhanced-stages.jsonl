{"cluster_id": "b4-c6-enhanced-pipeline-stages", "seed_level": 2, "source_files": ["education/book-04-workflows/06_enhanced_pipeline_stages.md"], "topics": ["enhanced-stages", "stream-processing", "within-target"], "questions": ["What are enhanced pipeline stages?", "How do enhanced stages differ from cross-target pipelines?", "What types of enhanced stages exist?"], "answer": {"text": "## Enhanced Pipeline Stages\n\nPowerful building blocks for within-target data processing.\n\n### vs Cross-Target Pipelines\n\n| Aspect | Cross-Target | Enhanced Stages |\n|--------|--------------|------------------|\n| Scope | AWK → Python → Go | Within one target |\n| Use | Different languages | Same language |\n| Chapter | Chapter 3 | Chapter 6 |\n\n### Stage Categories\n\n| Category | Stages |\n|----------|--------|\n| Stream combination | interleave, concat, zip |\n| Flow control | fan_out, parallel, merge |\n| Filtering | filter_by, batch, unbatch |\n| Aggregation | group_by, reduce, distinct |\n| Error handling | try_catch, retry, timeout |\n| Throughput | rate_limit, throttle, buffer |\n\n### Usage\n\n```prolog\ncompile_enhanced_pipeline([\n    parse/1,\n    filter_by(is_valid),\n    distinct,\n    output/1\n], [pipeline_name(my_pipe)], Code).\n```", "anchor_question_hash": "b4c6001a"}}
{"cluster_id": "b4-c6-stream-combination", "seed_level": 3, "source_files": ["education/book-04-workflows/06_enhanced_pipeline_stages.md"], "topics": ["interleave", "concat", "zip", "stream-merging"], "questions": ["What is the difference between interleave and concat?", "How does the zip stage work?", "When should you use interleave vs concat?"], "answer": {"text": "## Stream Combination Stages\n\n### interleave vs concat\n\n**interleave(Stages)**: Round-robin alternating\n```\n[A1,A2,A3] + [B1,B2] → [A1,B1,A2,B2,A3]\n```\n\n**concat(Stages)**: Sequential append\n```\n[A1,A2] + [B1,B2,B3] → [A1,A2,B1,B2,B3]\n```\n\n| Aspect | interleave | concat |\n|--------|------------|--------|\n| Order | Alternating | Sequential |\n| Fairness | Balanced | First priority |\n| Use case | Fair merge | Union/append |\n\n### zip(Stages)\n\nRuns multiple stages on same input, combines outputs:\n\n```prolog\nzip([\n    geocode/1,\n    sentiment/1,\n    categorize/1\n])\n```\n\nEach record gets all three enrichments.", "anchor_question_hash": "b4c6002a"}}
{"cluster_id": "b4-c6-flow-control", "seed_level": 3, "source_files": ["education/book-04-workflows/06_enhanced_pipeline_stages.md"], "topics": ["fan-out", "parallel", "route-by", "flow-control"], "questions": ["How do fan_out and parallel stages work?", "What is conditional routing with route_by?", "How do you merge results from parallel stages?"], "answer": {"text": "## Flow Control Stages\n\n### fan_out(Stages)\n\nBroadcasts each record to multiple stages:\n\n```prolog\nfan_out([validate/1, enrich/1, audit/1]),\nmerge\n```\n\n### parallel(Stages)\n\nExecutes stages concurrently for performance:\n\n```prolog\nparallel([\n    slow_transform_a/1,\n    slow_transform_b/1\n]),\nmerge\n```\n\n### route_by(Pred, Routes)\n\nConditional routing based on record type:\n\n```prolog\nroute_by(get_type, [\n    (error, error_handler/1),\n    (warning, warning_handler/1),\n    (info, info_handler/1)\n])\n```\n\n### merge\n\nCombines results from fan_out or parallel:\n- Collects outputs from all branches\n- Maintains record order where possible", "anchor_question_hash": "b4c6003a"}}
{"cluster_id": "b4-c6-error-throughput", "seed_level": 3, "source_files": ["education/book-04-workflows/06_enhanced_pipeline_stages.md"], "topics": ["error-handling", "retry", "rate-limit", "resilience"], "questions": ["How do you handle errors in enhanced pipelines?", "What retry and timeout options are available?", "How do you control throughput in pipelines?"], "answer": {"text": "## Error Handling Stages\n\n### try_catch(Stage, Handler)\n\n```prolog\ntry_catch(risky_transform/1, error_fallback/1)\n```\n\n### retry(Stage, N, Opts)\n\n```prolog\nretry(call_api/1, 3, [\n    delay(1000),\n    backoff(exponential)\n])\n```\n\n### timeout(Stage, Ms, Fallback)\n\n```prolog\ntimeout(slow_op/1, 5000, use_cached/1)\n```\n\n## Throughput Control\n\n### rate_limit(N, Per)\n\n```prolog\nrate_limit(100, second)  % 100 records/sec\n```\n\n### Other Controls\n\n| Stage | Effect |\n|-------|--------|\n| `throttle(Ms)` | Fixed delay |\n| `buffer(N)` | Collect N records |\n| `debounce(Ms)` | Wait for quiet period |\n\n### Production Pipeline\n\n```prolog\n[\n    try_catch(retry(process/1, 3), log_error/1),\n    rate_limit(50, second),\n    batch(100),\n    bulk_output/1\n]\n```", "anchor_question_hash": "b4c6004a"}}
