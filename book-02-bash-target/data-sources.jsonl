{"cluster_id": "data-sources-overview", "seed_level": 2, "source_files": ["education/book-02-bash-target/data_sources_pipeline_guide.md", "src/unifyweaver/sources.pl"], "topics": ["data-sources", "csv", "http", "json", "python", "etl"], "questions": ["What data sources does UnifyWeaver support?", "How do I use external data in UnifyWeaver?", "What is the source/3 predicate?", "How do I compile CSV data to Bash?"], "answer": {"text": "## Data Sources in UnifyWeaver\n\nDefine external data sources in Prolog and compile to Bash.\n\n### Supported Source Types\n\n| Type | Use Case | Options |\n|------|----------|--------|\n| `csv` | CSV/TSV files | `csv_file`, `has_header`, `delimiter` |\n| `http` | Web APIs | `url`, `headers`, `cache_duration` |\n| `json` | JSON files | `json_file`, `json_path` |\n| `python` | Complex transforms | `python_inline`, `python_file` |\n\n### The source/3 Predicate\n\n```prolog\nsource(Type, Name, Options)\n```\n\n### Example: CSV Source\n\n```prolog\n:- use_module('src/unifyweaver/sources').\n:- load_files('src/unifyweaver/sources/csv_source', [imports([])]).\n\n:- source(csv, users, [\n    csv_file('examples/demo_users.csv'),\n    has_header(true),\n    delimiter(',')\n]).\n% Creates: users/4 (id, name, role, department)\n```\n\n### Compilation\n\n```prolog\n?- compile_dynamic_source(users/4, [], BashCode).\n```\n\n### Generated Bash\n\n```bash\nusers() {\n    local target_key=\"$1\"\n    \n    if [[ -z \"$target_key\" ]]; then\n        # Stream all rows\n        awk -F\",\" '\n        NR > 1 {\n            gsub(/\"/, \"\", $0)\n            if (NF >= 4) print $1\":\"$2\":\"$3\":\"$4\n        }' examples/demo_users.csv\n    else\n        # Lookup mode\n        awk -F\",\" -v key=\"$target_key\" '\n        NR > 1 {\n            gsub(/\"/, \"\", $0)\n            if (NF >= 4 && $1 == key) print $1\":\"$2\":\"$3\":\"$4\n        }' examples/demo_users.csv\n    fi\n}\n\nusers_stream() {\n    users\n}\n```\n\n### Usage\n\n```bash\nsource output/users.sh\nusers_stream | awk -F: '$3 == \"Developer\"'\n```", "anchor_question_hash": "b0c1d2e3f4a56789"}}
{"cluster_id": "data-sources-pipeline", "seed_level": 3, "source_files": ["education/book-02-bash-target/data_sources_pipeline_guide.md", "src/unifyweaver/core/dynamic_source_compiler.pl"], "topics": ["pipeline", "etl", "data-processing", "awk"], "questions": ["How do I build ETL pipelines with UnifyWeaver?", "How do I filter and transform data sources?", "What pipeline operations are available?", "How do I aggregate data in Bash pipelines?"], "answer": {"text": "## Building ETL Pipelines\n\nCombine UnifyWeaver sources with Unix pipeline operations.\n\n### Pipeline Operations\n\n**Streaming:**\n```bash\nusers_stream  # Stream all records\n```\n\n**Filtering:**\n```bash\nusers_stream | awk -F: '$3 == \"Developer\"'\n```\n\n**Transformation:**\n```bash\nusers_stream | while IFS=: read id name role dept; do\n    echo \"$name works in $dept\"\ndone\n```\n\n**Aggregation:**\n```bash\nusers_stream | awk -F: '{dept[$4]++} END {\n    for (d in dept) print d\": \"dept[d]\n}'\n```\n\n### Complete ETL Example\n\n```prolog\n% Define source\n:- source(csv, users, [\n    csv_file('data/users.csv'),\n    has_header(true)\n]).\n\n% Compile and create pipeline\nmain :-\n    compile_dynamic_source(users/4, [], BashCode),\n    open('output/users.sh', write, S),\n    write(S, BashCode),\n    close(S),\n    create_pipeline.\n\ncreate_pipeline :-\n    Pipeline = '#!/bin/bash\nsource output/users.sh\n\necho \"All users:\"\nusers_stream | while IFS=: read id name role dept; do\n    echo \"  $name ($role) in $dept\"\ndone\n\necho \"\"\necho \"Developers:\"\nusers_stream | awk -F: \\'$3 == \"Developer\"\\' |\n    while IFS=: read id name role dept; do\n        echo \"  $name\"\n    done\n\necho \"\"\necho \"By department:\"\nusers_stream | awk -F: \\'{dept[$4]++} END {\n    for (d in dept) print \"  \" d \": \" dept[d]\n}\\'',\n    open('output/pipeline.sh', write, S),\n    write(S, Pipeline),\n    close(S).\n```\n\n### Loading Multiple Plugins\n\nUse `load_files` with `imports([])` to avoid conflicts:\n\n```prolog\n:- use_module('src/unifyweaver/sources').\n:- load_files('src/unifyweaver/sources/csv_source', [imports([])]).\n:- load_files('src/unifyweaver/sources/http_source', [imports([])]).\n:- load_files('src/unifyweaver/sources/json_source', [imports([])]).\n```", "anchor_question_hash": "c1d2e3f4a5b67890"}}
