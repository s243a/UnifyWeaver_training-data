{"pair_id": "sql-set-001_p0", "cluster_id": "sql-set-001", "question": "How do I use UNION in the SQL target?", "question_type": "medium", "answer": "To use `UNION` in the SQL target, you call the `compile_set_operation/4` predicate, specifying either `union` or `union_all` as the operator. This allows you to combine results from multiple Prolog predicates into a single SQL query.\n\n```prolog\n% Define the predicates you wish to combine\nus_staff(Name, Dept) :- employees_us(_, Name, Dept, _).\nuk_staff(Name, Dept) :- employees_uk(_, Name, Dept, _).\n\n% UNION (removes duplicate records)\n?- compile_set_operation(union, [us_staff/2, uk_staff/2], [], SQL).\n\n% UNION ALL (retains all records, including duplicates)\n?- compile_set_operation(union_all, [us_staff/2, uk_staff/2], [], SQL).\n```\n\nYou can also perform multi-way unions by adding more predicates to the input list. It is important to ensure that all predicates have the same number of columns and compatible data types. For more comprehensive details on set operations, refer to `education/book-10-sql-target/09_set_operations.md`.", "answer_variant": "default", "answer_source": "book-10-sql-target/09_set_operations.md", "topics": [], "original_answer": "Use `compile_set_operation/4` to combine query results:\n\n```prolog\nus_employees(Name, Dept) :- employees_us(_, Name, Dept, _).\nuk_employees(Name, Dept) :- employees_uk(_, Name, Dept, _).\n\n% UNION (removes duplicates)\n?- compile_set_operation(union, [us_employees/2, uk_employees/2], [], SQL).\n\n% UNION ALL (keeps duplicates, more efficient)\n?- compile_set_operation(union_all, [us_employees/2, uk_employees/2], [], SQL).\n```\n\nMulti-way unions:\n```prolog\n?- compile_set_operation(union,\n    [us_employees/2, uk_employees/2, contractor_workers/2], [], SQL).\n```\n\nAll predicates must have same column count and compatible types.", "answer_tailored": true}
{"pair_id": "sql-set-001_p0", "cluster_id": "sql-set-001", "question": "How do I use INTERSECT and EXCEPT in the SQL target?", "question_type": "medium", "answer": "To use `INTERSECT` and `EXCEPT` in the SQL target, you employ the `compile_set_operation/4` predicate. These operations allow you to compare results across multiple Prolog predicates.\n\n**INTERSECT**\nThe `intersect` operation retrieves rows that are present in every specified query. For example, to find customers who appeared in both 2023 and 2024 datasets:\n```prolog\ncustomers_23(Email) :- customers_2023(_, _, Email).\ncustomers_24(Email) :- customers_2024(_, _, Email).\n\n% Returns emails found in both predicates\n?- compile_set_operation(intersect, [customers_23/1, customers_24/1], [], SQL).\n```\n\n**EXCEPT**\nThe `except` operation returns rows from the first query that do not exist in the following queries. Because this is a set difference, the order of your predicates is significant:\n```prolog\n% Identify new customers (present in 2024 but missing from 2023)\n?- compile_set_operation(except, [customers_24/1, customers_23/1], [], SQL).\n\n% Identify churned customers (present in 2023 but missing from 2024)\n?- compile_set_operation(except, [customers_23/1, customers_24/1], [], SQL).\n```\n\nIf you need to include duplicate rows, you can use the `_all` variants: `intersect_all` and `except_all`. Detailed implementation examples for SQL set logic can be found in `education/book-10-sql-target/09_set_operations.md`.", "answer_variant": "default", "answer_source": "book-10-sql-target/09_set_operations.md", "topics": [], "original_answer": "**INTERSECT** - rows in ALL queries:\n```prolog\ncustomers_23(Email) :- customers_2023(_, _, Email).\ncustomers_24(Email) :- customers_2024(_, _, Email).\n\n% Retained customers (in both years)\n?- compile_set_operation(intersect, [customers_23/1, customers_24/1], [], SQL).\n```\n\n**EXCEPT** - rows in first query but not subsequent:\n```prolog\n% New customers (in 2024 but not 2023)\n?- compile_set_operation(except, [customers_24/1, customers_23/1], [], SQL).\n\n% Churned customers (in 2023 but not 2024)\n?- compile_set_operation(except, [customers_23/1, customers_24/1], [], SQL).\n```\n\nNote: Order matters for EXCEPT! `A EXCEPT B` is different from `B EXCEPT A`.\n\nAll variants support `_all` suffix: `intersect_all`, `except_all`.", "answer_tailored": true}
