{"cluster_id": "bash-target-design", "seed_level": 2, "source_files": ["education/book-01-foundations/03_unifyweaver_architecture.md", "docs/targets/bash.md"], "topics": ["bash", "code-generation", "associative-arrays", "streaming", "templates"], "questions": ["How does UnifyWeaver generate Bash code?", "How are Prolog facts compiled to Bash?", "What does generated Bash code look like?", "How does Bash target handle recursion?"], "answer": {"text": "## Bash Target Design\n\nThe Bash target uses template-driven code generation to create shell scripts that operate over textual streams.\n\n## Facts → Associative Arrays\n\nProlog facts compile to `declare -A` associative arrays:\n\n```prolog\n% Prolog facts\nparent(alice, bob).\nparent(bob, charlie).\n```\n\nGenerated Bash:\n\n```bash\n#!/bin/bash\n# parent - fact lookup\ndeclare -A parent_data=(\n    [alice:bob]=1\n    [bob:charlie]=1\n)\n\nparent() {\n    local key=\"$1:$2\"\n    [[ -n \"${parent_data[$key]}\" ]] && echo \"$key\"\n}\n\nparent_stream() {\n    for key in \"${!parent_data[@]}\"; do\n        echo \"$key\"\n    done\n}\n\nparent_reverse_stream() {\n    for key in \"${!parent_data[@]}\"; do\n        IFS=\":\" read -r a b <<< \"$key\"\n        echo \"$b:$a\"\n    done\n}\n```\n\n## Recursion → BFS with Memoization\n\nTransitive closures use BFS loops with visited tracking:\n\n```bash\nancestor_all() {\n    declare -A visited\n    local queue=()\n    \n    # Initialize with base cases\n    while IFS=: read -r a b; do\n        queue+=(\"$a:$b\")\n    done < <(parent_stream)\n    \n    # BFS traversal\n    while [[ ${#queue[@]} -gt 0 ]]; do\n        local current=\"${queue[0]}\"\n        queue=(\"${queue[@]:1}\")\n        \n        [[ -n \"${visited[$current]}\" ]] && continue\n        visited[$current]=1\n        echo \"$current\"\n        \n        # Expand frontier\n        IFS=: read -r _ child <<< \"$current\"\n        while IFS=: read -r a b; do\n            [[ \"$a\" == \"$child\" ]] && queue+=(\"${current%%:*}:$b\")\n        done < <(parent_stream)\n    done\n}\n```\n\n## Key Features\n\n- **Deduplication**: `declare -A` provides O(1) lookup\n- **Streaming**: Functions output to stdout for piping\n- **Cycle detection**: `visited` array prevents infinite loops", "anchor_question_hash": "6612e971e55128d4"}}
